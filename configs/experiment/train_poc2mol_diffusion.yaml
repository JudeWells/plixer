# @package _global_

# To run: python train.py experiment=train_poc2mol_diffusion.yaml

defaults:
  - _self_
  - override /data: poc2mol_plinder_data
  - override /model: poc2mol

seed: 42

trainer:
  max_epochs: 100
  gradient_clip_val: 1.0
  accumulate_grad_batches: 1
  precision: 32

model:
  loss:
    name: DiffusionLoss
    loss_type: mse
    l1_weight: 0.0  # Set to > 0 if you want to use L1 loss as regularization
  config:
    in_channels: 13  # Total channels after concatenation (from error message)
    out_channels: 9  # Noise prediction for ligand
    final_sigmoid: false  # No sigmoid for noise prediction
    diffusion:
      enabled: true
      timesteps: 1000
      beta_schedule: linear
      beta_start: 0.0001
      beta_end: 0.02
  lr: 3e-4
  weight_decay: 1e-5
  scheduler_name: cosine
  num_warmup_steps: 50
  num_training_steps: 100000


logger:
  wandb:
    entity: cath
    project: poc2molDiff
    tags: ["diffusion", "unet", "3d"]
    name: "diffusion_poc2mol"
data:
  config:
    dtype: ${oc.select:torch.float32,torch.float32}
  num_workers: 5
  train_dataset:
    _target_: src.data.poc2mol.datasets.PlinderParquetDataset
    data_path: "example_data/plinder_example"
    config: ${data.config}
  val_dataset:
    _target_: src.data.poc2mol.datasets.PlinderParquetDataset
    data_path: "example_data/plinder_example"
    config: ${data.config}
  test_dataset:
    _target_: src.data.poc2mol.datasets.PlinderParquetDataset
    data_path: "example_data/plinder_example"
    config: ${data.config}